<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DesiConnect Portal</title>
<style>

    body {

      font-family: Arial, sans-serif;

      margin: 0;

      padding: 0;

    }

    header {

      background-color: #ff5722;

      color: white;

      padding: 1rem;

      text-align: center;

      font-size: 1.5rem;

    }

    #filters {

      padding: 1rem;

      background: #f9f9f9;

      display: flex;

      flex-wrap: wrap;

      gap: 1rem;

      align-items: center;

      justify-content: center;

    }

    #map {

      width: 100%;

      height: 400px;

    }

    #results {

      padding: 1rem;

    }

    .result-card {

      display: flex;

      align-items: center;

      border-bottom: 1px solid #ccc;

      padding: 10px 0;

    }

    .result-card img {

      width: 80px;

      height: 80px;

      object-fit: cover;

      margin-right: 15px;

      border-radius: 8px;

    }

    .category-list {

      display: flex;

      overflow-x: auto;

      padding: 10px;

      background: #fff3e0;

    }

    .category {

      padding: 8px 15px;

      background: #eee;

      margin: 0 5px;

      border-radius: 20px;

      cursor: pointer;

      white-space: nowrap;

    }

    .category.active {

      background: #ff5722;

      color: white;

    }
</style>
</head>
<body>
<header>DesiConnect</header>
<div id="filters">
<input type="text" id="locationInput" placeholder="Enter ZIP or City">
<label for="radiusInput">Radius: <span id="radiusLabel">15 miles</span></label>
<input type="range" id="radiusInput" min="1" max="50" value="15">
<label for="sortSelect">Sort by:</label>
<select id="sortSelect">
<option value="distance">Distance</option>
<option value="rating">Rating</option>
</select>
</div>
<div class="category-list" id="categoryList">
<div class="category active" data-type="restaurant">Restaurants</div>
<div class="category" data-type="grocery_or_supermarket">Grocery</div>
<div class="category" data-type="hindu_temple">Temples</div>
<div class="category" data-type="clothing_store">Clothing & Jewelry</div>
<div class="category" data-type="movie_theater">Events</div>
<div class="category" data-type="store">Vendors</div>
</div>
<div id="map"></div>
<div id="results"></div>
<!-- Load Google Maps JS API with Places and Geometry libraries -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDojYBUKgNSruHUBJIKwMqXbDHzLQIphws&libraries=places,geometry"></script>
<script>

  let map, service, markers = [];

  let selectedType = 'restaurant';

  let currentLat = null, currentLng = null;

  function initMap(lat, lng) {

    currentLat = lat;

    currentLng = lng;

    const location = new google.maps.LatLng(lat, lng);

    map = new google.maps.Map(document.getElementById("map"), {

      center: location,

      zoom: 12,

    });

    service = new google.maps.places.PlacesService(map);

  }

  function searchPlaces(customType = null) {

    const locationInput = document.getElementById("locationInput").value;

    const radius = parseInt(document.getElementById("radiusInput").value) * 1609.34;

    const placeType = customType || selectedType;

    const performSearch = (lat, lng) => {

      currentLat = lat;

      currentLng = lng;

      initMap(lat, lng);

      clearMarkers();

      const request = {

        location: new google.maps.LatLng(lat, lng),

        radius: radius,

        type: placeType

      };

      document.getElementById("results").innerHTML = "<p>Loading...</p>";

      service.nearbySearch(request, (places, status) => {

        const resultsContainer = document.getElementById("results");

        resultsContainer.innerHTML = "<h3>Search Results</h3>";

        if (status === google.maps.places.PlacesServiceStatus.OK && places.length > 0) {

          // Add distance property

          places.forEach(place => {

            const placeLoc = place.geometry.location;

            place.geometry.location.distanceFrom = google.maps.geometry.spherical.computeDistanceBetween(

              new google.maps.LatLng(currentLat, currentLng),

              placeLoc

            );

          });

          // Sort by selection

          const sortOption = document.getElementById("sortSelect").value;

          places.sort((a, b) => {

            if (sortOption === "rating") return (b.rating || 0) - (a.rating || 0);

            if (sortOption === "distance") return (a.geometry.location.distanceFrom || 0) - (b.geometry.location.distanceFrom || 0);

            return 0;

          });

          places.forEach(place => {

            const card = document.createElement("div");

            card.className = "result-card";

            card.innerHTML = `
<img src="${place.photos ? place.photos[0].getUrl({ maxWidth: 80 }) : 'https://via.placeholder.com/80'}">
<div>
<strong>${place.name}</strong><br>

                ${place.vicinity}<br>

                ‚≠ê ${place.rating || 'N/A'}
</div>`;

            resultsContainer.appendChild(card);

            const marker = new google.maps.Marker({

              map,

              position: place.geometry.location,

              icon: {

                url: "https://maps.google.com/mapfiles/ms/icons/orange-dot.png",

                scaledSize: new google.maps.Size(40, 40)

              },

              title: place.name

            });

            markers.push(marker);

          });

        } else {

          resultsContainer.innerHTML += "<p>No results found.</p>";

        }

      });

    };

    if (locationInput.trim()) {

      const geocoder = new google.maps.Geocoder();

      geocoder.geocode({ address: locationInput }, (results, status) => {

        if (status === 'OK') {

          const loc = results[0].geometry.location;

          performSearch(loc.lat(), loc.lng());

        } else {

          alert('Location not found');

        }

      });

    } else if (currentLat && currentLng) {

      performSearch(currentLat, currentLng);

    } else {

      navigator.geolocation.getCurrentPosition(pos => {

        performSearch(pos.coords.latitude, pos.coords.longitude);

      }, () => {

        alert("Enable GPS or enter ZIP/City.");

      });

    }

  }

  function clearMarkers() {

    markers.forEach(marker => marker.setMap(null));

    markers = [];

  }

  document.getElementById("categoryList").addEventListener("click", function (e) {

    if (e.target.closest(".category")) {

      document.querySelectorAll(".category").forEach(cat => cat.classList.remove("active"));

      const selected = e.target.closest(".category");

      selected.classList.add("active");

      selectedType = selected.dataset.type;

      searchPlaces();

    }

  });

  document.getElementById("radiusInput").addEventListener("input", function () {

    document.getElementById("radiusLabel").innerText = `${this.value} miles`;

  });

  document.getElementById("sortSelect").addEventListener("change", function () {

    searchPlaces();

  });

  window.onload = function () {

    navigator.geolocation.getCurrentPosition(pos => {

      const lat = pos.coords.latitude;

      const lng = pos.coords.longitude;

      initMap(lat, lng);

      searchPlaces();

    }, () => {

      const lat = 39.0438;  // Default to Ashburn, VA

      const lng = -77.4874;

      initMap(lat, lng);

      searchPlaces();

    });

  };
</script>
</body>
</html>
 